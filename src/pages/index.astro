---
import BaseLayout from "../layouts/BaseLayout.astro";
import HeroSection from "../components/HeroSection.astro";
import ServerCard from "../components/ServerCard.astro";
import { getTranslation, getUserLocale } from "../utils/i18n";
import servers from "../data/servers.json";

// Función para analizar las cookies del lado del servidor
function getServerCookie(cookieString, name) {
  if (!cookieString) return null;
  const cookies = cookieString.split(';');
  for (const cookie of cookies) {
    const [cookieName, cookieValue] = cookie.trim().split('=');
    if (cookieName === name) {
      return cookieValue;
    }
  }
  return null;
}

// Definir el idioma predeterminado (no utilizamos headers en modo estático)
let locale: 'es' | 'en' = 'es';

// En producción con compilación estática, podemos usar funciones del navegador como localStorage 
// para obtener el idioma preferido del usuario, pero esto ocurrirá en el cliente
// Para la compilación utilizamos el locale predeterminado

// Traducir según el idioma
const t = (key: string) => getTranslation(key, locale);

---

<BaseLayout locale={locale}>
  <!-- Hero Section -->
  <HeroSection locale={locale} />

  <!-- Servidores Section -->
  <section id="servidores" class="py-20 px-4 relative overflow-hidden">
    <div class="container mx-auto">
      <h2 class="text-4xl font-bold text-center mb-12 text-primary animate-fade-up">{t('featured-servers')}</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
        {servers.map((server, index) => (
          <div class="server-item h-full flex flex-col">
            <ServerCard 
              id={server.id}
              name={server.name}
              slug={server.slug}
              isNew={server.isNew}
              isActive={server.isActive}
              image={server.images[0]}
              logo={server.logo}
              collaborators={server.collaborators}
              descriptionKey={server.descriptionKey}
              locale={locale}
            />
          </div>
        ))}
        
        <!-- Próximamente card -->
        <div class="server-item col-span-1 md:col-span-full flex flex-col">
          <div class="server-card h-full flex flex-col relative overflow-hidden rounded-xl bg-secondary/60 backdrop-blur p-5 border border-primary/30 transition-all hover:border-primary/70 hover:shadow-glow group animate-fade-up" style="animation-delay: 300ms;">
            <div class="flex items-center justify-center h-48 bg-secondary/30 rounded-lg relative overflow-hidden">
              <!-- Fondo de estrellas que cubre toda el área -->
              <div class="stars-bg absolute inset-0">
                {Array.from({ length: 50 }).map((_, i) => (
                  <div 
                    class="star absolute rounded-full bg-white"
                    style={`
                      top: ${Math.random() * 100}%; 
                      left: ${Math.random() * 100}%; 
                      width: ${1 + Math.random() * 2}px; 
                      height: ${1 + Math.random() * 2}px;
                      opacity: ${0.2 + Math.random() * 0.8};
                      animation: twinkle ${1 + Math.random() * 5}s infinite ${Math.random() * 5}s;
                    `}
                  ></div>
                ))}
              </div>
              
              <!-- Signo de interrogación central con glow -->
              <div class="flex items-center justify-center w-full h-full relative z-10">
                <span class="text-7xl text-primary question-mark">?</span>
              </div>
              
              <!-- Nebulosa decorativa -->
              <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 opacity-30 rounded-full bg-gradient-radial from-primary/40 via-primary/10 to-transparent blur-xl"></div>
            </div>
            
            <h3 class="text-2xl font-bold mt-4 text-primary text-center">???</h3>
            <p class="text-white/80 my-3 min-h-[60px] text-center">{t('coming-soon-desc')}</p>
            <div class="mt-auto">
              <a href="#" class="block w-full bg-gradient-to-r from-primary/50 to-primary/50 text-white py-3 rounded-lg text-center font-bold transition-all duration-300 relative overflow-hidden opacity-70 cursor-not-allowed hover:opacity-80">
                <span class="relative z-10">{t('stay-tuned')}</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Servicios Section -->
  <section id="servicios" class="py-20 px-4 relative overflow-hidden bg-secondary/30">
    <div class="container mx-auto max-w-6xl">
      <h2 class="text-4xl font-bold text-center mb-6 text-primary animate-fade-up">
        <span class="relative inline-block">
          {t('our-services')}
          <span class="absolute -bottom-2 left-0 w-full h-1 bg-primary/60 rounded-full"></span>
        </span>
      </h2>
      
      <p class="text-xl text-center text-white/90 mb-12 animate-fade-up animate-delay-200">{t('services-intro')}</p>
      
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8 mb-16">
        <div class="service-item bg-secondary/40 rounded-xl p-6 hover:bg-secondary/60 transition-all duration-300 border-l-4 border-primary/70 animate-fade-up animate-delay-300 shadow-md hover:shadow-primary/20 hover:-translate-y-1 group">
          <div class="flex items-center mb-4">
            <span class="text-primary text-3xl group-hover:scale-110 transition-transform duration-300"><i class="fas fa-server"></i></span>
            <h3 class="text-xl font-bold text-white ml-4">{t('service-1')}</h3>
          </div>
          <p class="text-white/80">Diseñamos servidores únicos adaptados a tus necesidades, con características personalizadas y configuración optimizada para la mejor experiencia.</p>
        </div>
        
        <div class="service-item bg-secondary/40 rounded-xl p-6 hover:bg-secondary/60 transition-all duration-300 border-l-4 border-primary/70 animate-fade-up animate-delay-300 shadow-md hover:shadow-primary/20 hover:-translate-y-1 group">
          <div class="flex items-center mb-4">
            <span class="text-primary text-3xl group-hover:scale-110 transition-transform duration-300"><i class="fas fa-tools"></i></span>
            <h3 class="text-xl font-bold text-white ml-4">{t('service-2')}</h3>
          </div>
          <p class="text-white/80">Nos encargamos de mantener tu servidor funcionando sin problemas, con actualizaciones regulares, backups y soporte técnico disponible.</p>
        </div>
        
        <div class="service-item bg-secondary/40 rounded-xl p-6 hover:bg-secondary/60 transition-all duration-300 border-l-4 border-primary/70 animate-fade-up animate-delay-300 shadow-md hover:shadow-primary/20 hover:-translate-y-1 group">
          <div class="flex items-center mb-4">
            <span class="text-primary text-3xl group-hover:scale-110 transition-transform duration-300"><i class="fas fa-cubes"></i></span>
            <h3 class="text-xl font-bold text-white ml-4">{t('service-3')}</h3>
          </div>
          <p class="text-white/80">Creamos modpacks temáticos y personalizados que ofrecen experiencias inmersivas y únicas para tu comunidad de jugadores.</p>
        </div>
        
        <div class="service-item bg-secondary/40 rounded-xl p-6 hover:bg-secondary/60 transition-all duration-300 border-l-4 border-primary/70 animate-fade-up animate-delay-400 shadow-md hover:shadow-primary/20 hover:-translate-y-1 group">
          <div class="flex items-center mb-4">
            <span class="text-primary text-3xl group-hover:scale-110 transition-transform duration-300"><i class="fas fa-download"></i></span>
            <h3 class="text-xl font-bold text-white ml-4">Instalador personalizado para modpacks</h3>
          </div>
          <p class="text-white/80">Desarrollamos un instalador con interfaz gráfica intuitiva que descarga automáticamente el modpack, crea el perfil del servidor y permite jugar con solo pulsar un botón.</p>
        </div>
        
        <div class="service-item bg-secondary/40 rounded-xl p-6 hover:bg-secondary/60 transition-all duration-300 border-l-4 border-primary/70 animate-fade-up animate-delay-400 shadow-md hover:shadow-primary/20 hover:-translate-y-1 group">
          <div class="flex items-center mb-4">
            <span class="text-primary text-3xl group-hover:scale-110 transition-transform duration-300"><i class="fas fa-cloud"></i></span>
            <h3 class="text-xl font-bold text-white ml-4">{t('service-5')}</h3>
          </div>
          <p class="text-white/80">Ofrecemos soluciones de hosting optimizadas para Minecraft con hardware de alto rendimiento y protección contra DDoS.</p>
        </div>
        
        <div class="service-item bg-primary/20 rounded-xl p-6 hover:bg-primary/30 transition-all duration-300 border-l-4 border-primary animate-fade-up animate-delay-400 shadow-md hover:shadow-primary/20 hover:-translate-y-1 group">
          <div class="flex items-center mb-4">
            <span class="text-primary text-3xl group-hover:scale-110 transition-transform duration-300"><i class="fas fa-headset"></i></span>
            <h3 class="text-xl font-bold text-white ml-4">Atención personalizada</h3>
          </div>
          <p class="text-white/80">Trabajamos estrechamente contigo para entender tus necesidades y ofrecerte soluciones adaptadas a tu proyecto específico.</p>
        </div>
      </div>
      
      <div class="flex justify-center animate-fade-up animate-delay-500">
        <a href="/servicios" class="px-8 py-3 rounded-lg bg-primary/90 text-white font-bold shadow-glow border border-primary/50 transition-all duration-300 hover:shadow-lg hover:bg-primary hover:border-primary hover:-translate-y-1 relative overflow-hidden group">
          <span class="relative z-10">{t('learn-more')}</span>
          <span class="absolute inset-0 bg-gradient-to-r from-primary to-blue-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
        </a>
      </div>
    </div>
  </section>

  <!-- Colaboradores Section -->
  <section id="colaboradores" class="py-20 px-4 relative overflow-hidden">
    <div class="container mx-auto max-w-5xl">
      <h2 class="text-4xl font-bold text-center mb-6 text-primary animate-fade-up">{t('our-collaborators')}</h2>
      
      <p class="text-xl text-center text-white/90 mb-12 animate-fade-up animate-delay-200">{t('collaborators-intro')}</p>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 animate-fade-up animate-delay-300">
        <!-- Colaborador 1 -->
        <div class="collaborator bg-secondary/40 backdrop-blur rounded-xl p-6 border border-primary/30 hover:border-primary/70 hover:shadow-glow transition-all flex flex-col md:flex-row items-center md:items-start gap-6">
          <img 
            src="/imgs/servers/ancientkraft/colab.webp" 
            alt="Colaborador Los Picaos" 
            class="w-24 h-24 rounded-xl border-2 border-primary/50 hover:scale-105 transition-transform"
            width="96"
            height="96"
            loading="lazy"
          />
          <div>
            <div class="text-xl font-bold text-primary mb-1">Los Picaos</div>
            <div class="text-white/70 mb-4">{t('colab-lospicaos')}</div>
            <div class="flex space-x-3">
              <a 
                href="https://discord.gg/wB3n78uGY8"
                target="_blank"
                rel="noopener"
                class="text-white hover:text-primary transition-colors text-2xl"
                title="Discord"
              >
                <i class="fab fa-discord"></i>
              </a>
            </div>
          </div>
        </div>
        
        <!-- Colaborador 2 -->
        <div class="collaborator bg-secondary/40 backdrop-blur rounded-xl p-6 border border-primary/30 hover:border-primary/70 hover:shadow-glow transition-all flex flex-col md:flex-row items-center md:items-start gap-6">
          <img 
            src="/imgs/servers/pt-the_full_course/colab.webp" 
            alt="Colaborador PT: The Full Course" 
            class="w-24 h-24 rounded-xl border-2 border-primary/50 hover:scale-105 transition-transform"
            width="96"
            height="96"
            loading="lazy"
          />
          <div>
            <div class="text-xl font-bold text-primary mb-1">PT: The Full Course</div>
            <div class="text-white/70 mb-4">{t('colab-ptfullcourse')}</div>
            <div class="flex space-x-3">
              <a 
                href="https://discord.gg/pt-the-full-course-1080714738369036359"
                target="_blank"
                rel="noopener"
                class="text-white hover:text-primary transition-colors text-2xl"
                title="Discord"
              >
                <i class="fab fa-discord"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Nosotros, Donaciones y Contacto Sections -->
  <!-- Estos quedarían pendientes para la siguiente fase del desarrollo -->
  
  <!-- Ejemplo del resto de secciones para completar -->
  <section id="nosotros" class="py-20 px-4 relative overflow-hidden bg-secondary/30">
    <div class="container mx-auto max-w-4xl">
      <h2 class="text-4xl font-bold text-center mb-6 text-primary animate-fade-up">{t('about-us')}</h2>
      <p class="text-lg mb-6 animate-fade-up animate-delay-200">{t('about-1')}</p>
      <p class="text-lg mb-10 animate-fade-up animate-delay-300">{t('about-2')}</p>
      
      <h3 class="text-3xl font-bold text-center text-primary mt-16 mb-10 animate-fade-up">{t('team-title')}</h3>
      
      <!-- Equipo Fundador -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 animate-fade-up animate-delay-300">
        <!-- CEO y Fundador -->
        <div class="rounded-xl bg-secondary/60 backdrop-blur p-8 border border-primary/30 hover:border-primary/70 hover:shadow-glow transition-all">
          <div class="flex flex-col items-center mb-6">
            <img 
              src="https://mc-heads.net/avatar/Kristiansitou/120" 
              alt={t('ceo-name')}
              class="w-28 h-28 rounded-full border-4 border-primary/70 mb-4 hover:scale-105 transition-all"
              width="120"
              height="120"
              loading="lazy"
            />
            <h4 class="text-xl font-bold">
              {t('ceo-name')} <span class="text-sm opacity-70">({t('ceo-alias')})</span>
            </h4>
            <p class="text-primary font-bold mt-1">{t('ceo-role')}</p>
            <p class="text-sm text-white/60 mt-2">{t('ceo-skills')}</p>
          </div>
          
          <p class="text-white/80 mb-6 text-center sm:text-justify">
            {t('ceo-description')}
          </p>
          
          <div class="flex flex-wrap justify-center gap-2">
            <span class="px-3 py-1 bg-primary/20 rounded-md text-sm">Java</span>
            <span class="px-3 py-1 bg-primary/20 rounded-md text-sm">Python</span>
            <span class="px-3 py-1 bg-primary/20 rounded-md text-sm">C#</span>
            <span class="px-3 py-1 bg-primary/20 rounded-md text-sm">JS</span>
            <span class="px-3 py-1 bg-primary/20 rounded-md text-sm">Kotlin</span>
            <span class="px-3 py-1 bg-primary/20 rounded-md text-sm">PHP</span>
          </div>
        </div>
        
        <!-- Co-fundador -->
        <div class="rounded-xl bg-secondary/60 backdrop-blur p-8 border border-primary/30 hover:border-primary/70 hover:shadow-glow transition-all">
          <div class="flex flex-col items-center mb-6">
            <img 
              src="https://mc-heads.net/avatar/Junior373_/120" 
              alt={t('cofounder-name')}
              class="w-28 h-28 rounded-full border-4 border-primary/70 mb-4 hover:scale-105 transition-all"
              width="120"
              height="120"
              loading="lazy"
            />
            <h4 class="text-xl font-bold">
              {t('cofounder-name')} <span class="text-sm opacity-70">({t('cofounder-alias')})</span>
            </h4>
            <p class="text-primary font-bold mt-1">{t('cofounder-role')}</p>
            <p class="text-sm text-white/60 mt-2">{t('cofounder-skills')}</p>
          </div>
          
          <p class="text-white/80 text-center sm:text-justify">
            {t('cofounder-description')}
          </p>
        </div>
      </div>
      
      <!-- Workers Section -->
      <div class="mt-16 p-6 rounded-xl bg-primary/10 border-l-4 border-primary animate-fade-up animate-delay-500">
        <h4 class="text-xl font-bold text-primary mb-3">{t('workers-title')}</h4>
        <p class="text-white/80 mb-6">{t('workers-description')}</p>
        
        <div id="workers-container" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-9 gap-4 justify-items-center">
          <!-- Los workers se cargarán mediante JS -->
        </div>
      </div>
    </div>
  </section>

  <section id="donaciones" class="py-20 px-4 relative overflow-hidden">
    <div class="container mx-auto max-w-4xl text-center">
      <h2 class="text-4xl font-bold text-center mb-6 text-primary animate-fade-up">{t('donate-section')}</h2>
      <p class="text-lg mb-10 animate-fade-up animate-delay-200">{t('donate-intro')}</p>
      <div id="donate-button-container" class="flex justify-center items-center animate-fade-up animate-delay-300"></div>
    </div>
  </section>

  <section id="contacto" class="py-20 px-4 relative overflow-hidden bg-secondary/30">
    <div class="container mx-auto max-w-4xl text-center">
      <h2 class="text-4xl font-bold text-center mb-6 text-primary animate-fade-up">{t('contact-us')}</h2>
      <p class="text-lg mb-10 animate-fade-up animate-delay-200">{t('contact-intro')}</p>
      <div class="animate-fade-up animate-delay-300">
        <p id="email-placeholder" class="mb-6 text-xl">info@luminakraft.com</p>
        <a href="mailto:info@luminakraft.com" class="px-8 py-3 rounded-lg bg-primary/90 text-white font-bold shadow-glow border border-primary/50 transition-all duration-300 hover:shadow-lg hover:bg-primary hover:border-primary hover:-translate-y-1">
          {t('send-message')}
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  @keyframes twinkle {
    0%, 100% { opacity: 0.2; }
    50% { opacity: 1; }
  }
  
  .stars-bg {
    background-color: rgba(1, 16, 36, 0.9);
  }
  
  .question-mark {
    text-shadow: 0 0 15px rgba(74, 144, 226, 0.8), 0 0 30px rgba(74, 144, 226, 0.6);
    animation: pulse 3s infinite ease-in-out;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 0.7; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.1); }
  }
  
  /* Para crear gradientes radiales */
  .bg-gradient-radial {
    background-image: radial-gradient(var(--tw-gradient-stops));
  }
</style>

<script>
  // Script para PayPal
  document.addEventListener('DOMContentLoaded', function() {
    const donateContainer = document.getElementById('donate-button-container');
    
    if (donateContainer) {
      const paypalScript = document.createElement('script');
      paypalScript.src = 'https://www.paypalobjects.com/donate/sdk/donate-sdk.js';
      paypalScript.charset = 'UTF-8';
      
      paypalScript.onload = function() {
        // Usar tipo de aserción para evitar errores de TypeScript
        const PayPalWindow = window as any;
        if (typeof PayPalWindow.PayPal !== 'undefined') {
          PayPalWindow.PayPal.Donation.Button({
            env: 'production',
            hosted_button_id: '99GHNYAKDZQGU',
            image: {
              src: 'https://www.paypalobjects.com/es_ES/ES/i/btn/btn_donateCC_LG.gif',
              alt: 'Botón Donar con PayPal',
              title: 'PayPal - The safer, easier way to pay online!',
            }
          }).render('#donate-button-container');
        }
      };
      
      document.body.appendChild(paypalScript);
    }
    
    // Cargar workers
    const workersContainer = document.getElementById('workers-container');
    if (workersContainer) {
      fetch('/data/workers.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Error cargando workers');
          }
          return response.json();
        })
        .then(workers => {
          workers.forEach(worker => {
            const workerEl = document.createElement('div');
            workerEl.className = 'flex flex-col items-center justify-between w-full';
            
            workerEl.innerHTML = `
              <div class="worker-avatar-container border-2 border-primary/50 rounded-lg overflow-hidden w-16 h-16 md:w-20 md:h-20 hover:scale-110 transition-transform mx-auto">
                <img 
                  src="https://mc-heads.net/avatar/${worker.username}/64" 
                  alt="${worker.username}" 
                  class="w-full h-full object-cover"
                  width="64"
                  height="64"
                  loading="lazy"
                />
              </div>
              <p class="text-sm text-center mt-2 truncate w-full">${worker.username}</p>
            `;
            
            workersContainer.appendChild(workerEl);
          });
        })
        .catch(error => {
          console.error('Error al cargar los workers:', error);
          workersContainer.innerHTML = '<p class="text-white/50 text-center">Error al cargar los workers</p>';
        });
    }
  });
</script>