---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getTranslation, updateTextsForLocale, getUserLocale, updateTooltipsForLocale } from "../../utils/i18n";
import serversData from "../../data/servers.json";
import type { GetStaticPaths } from "astro";

// Definimos el tipo para locale explícitamente
export type Locale = 'es' | 'en';

// Definir el tipo Server para evitar errores de TypeScript
export type Server = {
  id: string;
  name: string;
  slug: string;
  isNew: boolean;
  isActive: boolean;
  images: string[];
  logo: string;
  collaborators: { name: string; logo: string }[];
  versions: string[];
  modloader: string;
  gamemode: string;
  descriptionKey: string;
  leaderboardPath?: string;
};

// Para precompilar las rutas estáticas en modo "static"
export const prerender = true;

// Generar rutas estáticas para cada servidor
export const getStaticPaths = (() => {
  // Para compilación estática, definimos los servidores directamente
  const servers = serversData as unknown as Server[];
  
  // Generate routes for all servers
  return servers.map((server: Server) => ({
    params: { slug: server.slug },
    props: { server }
  }));
}) satisfies GetStaticPaths;

// Obtener slug de la URL
const slugFromURL = Astro.params.slug;

// Obtener propiedades
const { server, locale: propLocale } = Astro.props as { server: Server, locale: Locale };

// Si no tenemos el servidor, redireccionar a la página principal
if (!server) {
  return Astro.redirect('/');
}

// Usar el servidor proporcionado en props (ya filtrado por slug)
const serverFromSlug: Server = server;

// Usar el idioma del usuario en lugar del valor predeterminado
const locale: Locale = getUserLocale();

// Traducir según el idioma
const t = (key: string) => getTranslation(key, locale);

// Título y descripción para SEO
const title = `${serverFromSlug.name} | LuminaKraft Studios`;
const description = t(serverFromSlug.descriptionKey);

// Determinar los colores específicos del servidor
let primaryColor = "#4a90e2"; // Color predeterminado
let secondaryColor = "#1a2735"; // Color secundario predeterminado

// Colores específicos por servidor
if (serverFromSlug.id === "onepieceworld") {
  primaryColor = "#ffb400";
  secondaryColor = "#1a2735";
} else if (serverFromSlug.id === "ancientkraft") {
  primaryColor = "#c0a080";
  secondaryColor = "#2a1f1f";
} else if (serverFromSlug.id === "pt-the_full_course") {
  primaryColor = "#ff5252";
  secondaryColor = "#2a2a2a";
}

// Definir video de YouTube si existe
const youtubeEmbed = {
  "onepieceworld": "https://www.youtube.com/embed/OadtwVyeRKI",
  "ancientkraft": "https://www.youtube.com/embed/SsBTE69AE8I",
  "pt-the_full_course": ""
}[serverFromSlug.id] || "";

// Características específicas por servidor
const serverFeatures = {
  "onepieceworld": [
    { icon: "fa-apple-whole", title: "Frutas del Diablo", description: "Consume poderosas frutas que te otorgarán habilidades especiales, ¡pero cuidado con el mar!" },
    { icon: "fa-fist-raised", title: "Combate con Haki y Estilos de Lucha", description: "Domina Haki, artes marciales y estilos de combate inspirados en personajes como Sanji o Zoro." },
    { icon: "fa-ship", title: "Explora el Grand Line", description: "Navega por islas legendarias, descubre tesoros y enfréntate a peligrosos piratas y marines." },
    { icon: "fa-users", title: "Aventuras Multijugador", description: "Únete a una tripulación, enfréntate a otros jugadores, o forma alianzas para dominar los mares." }
  ],
  "ancientkraft": [
    { icon: "fa-magic", title: "Sistema de Magia Personalizado", description: "Domina hechizos únicos y aprovecha el poder de los elementos" },
    { icon: "fa-fist-raised", title: "Combate Mejorado", description: "Experimenta batallas emocionantes con mecánicas y habilidades mejoradas" },
    { icon: "fa-map-marked-alt", title: "Vasto Mundo para Explorar", description: "Descubre ruinas antiguas, tesoros ocultos y mazmorras desafiantes" },
    { icon: "fa-users", title: "Aventuras Multijugador", description: "Forma equipo con amigos o únete a una facción para conquistar el mundo juntos" }
  ],
  "pt-the_full_course": [
    { icon: "fa-compass", title: "Exploración", description: "Descubre un mundo lleno de secretos y sorpresas por descubrir" },
    { icon: "fa-users", title: "Comunidad", description: "Únete a una comunidad amigable y colaborativa de jugadores" },
    { icon: "fa-puzzle-piece", title: "Plugins personalizados", description: "Disfruta de plugins exclusivos que mejoran la experiencia de juego" },
    { icon: "fa-calendar-alt", title: "Eventos regulares", description: "Participa en eventos especiales y competiciones organizadas por el staff" }
  ]
}[serverFromSlug.id] || [];

---

<BaseLayout title={title} description={description} locale={locale}>
  <!-- Estilos específicos del servidor -->
  <style define:vars={{ primaryColor, secondaryColor }}>
    .text-primary {
      color: var(--primaryColor);
    }
    .bg-primary {
      background-color: var(--primaryColor);
    }
    .hover\:bg-primary:hover {
      background-color: var(--primaryColor);
    }
    .from-primary {
      --tw-gradient-from: var(--primaryColor);
    }
    .to-primary {
      --tw-gradient-to: var(--primaryColor);
    }
    .border-primary {
      border-color: var(--primaryColor);
    }
    .shadow-glow {
      box-shadow: 0 0 15px rgba(var(--primaryColor), 0.5);
    }
    .bg-secondary {
      background-color: var(--secondaryColor);
    }
    
    /* Efectos de transición mejorados */
    .parallax-bg {
      position: relative;
      overflow: hidden;
    }
    
    .parallax-bg::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 30% 50%, var(--primaryColor) 0%, transparent 70%);
      opacity: 0.1;
      z-index: -1;
      transform: translateZ(0);
      transition: opacity 0.5s ease;
    }
    
    .hero-glow {
      position: relative;
    }
    
    .hero-glow::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, var(--primaryColor) 0%, transparent 70%);
      opacity: 0.2;
      z-index: -1;
      filter: blur(40px);
      transition: all 0.5s ease;
    }
    
    .feature-card {
      transition: transform 0.5s ease, box-shadow 0.5s ease, border-color 0.3s ease;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    .feature-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.2) 100%);
      z-index: -1;
      transition: opacity 0.5s ease;
      opacity: 0;
    }
    
    .feature-card:hover::before {
      opacity: 1;
    }
    
    .feature-card:hover .feature-icon {
      transform: translateY(-10px);
    }
    
    .feature-icon {
      transition: transform 0.5s ease;
    }
    
    .screenshot-container {
      position: relative;
      overflow: hidden;
    }
    
    .screenshot-overlay {
      display: none;
    }
    
    .screenshot-container:hover img {
      transform: scale(1.1);
    }
    
    .join-button {
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      z-index: 1;
    }
    
    .join-button::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.7s ease;
      z-index: 0;
    }
    
    .join-button:hover::before {
      left: 100%;
    }
  </style>

  <!-- Aviso de servidor cerrado si aplica -->
  {!serverFromSlug.isActive && (
    <div class="fixed top-[60px] left-0 right-0 z-50 bg-red-500/80 text-white py-1 px-4 text-center font-medium text-sm flex items-center justify-center gap-2">
      <i class="fas fa-circle-exclamation"></i>
      <span data-i18n="server-closed">{t('server-closed')}</span>
    </div>
  )}

  <div class="pt-24 pb-16 px-4 parallax-bg">
    <div class="container mx-auto max-w-6xl">
      <!-- Cabecera del servidor -->
      <div class="flex flex-col items-center text-center mb-12 reveal-element">
        <div class="w-48 h-48 md:w-64 md:h-64 lg:w-80 lg:h-80 flex items-center justify-center mb-6 hero-glow">
          <img 
            src={serverFromSlug.logo || serverFromSlug.images[0]} 
            alt={`${serverFromSlug.name} Logo`}
            class="scale-125 max-w-full max-h-full object-contain transition-transform duration-700 hover:scale-135"
            loading="eager"
          />
        </div>
        <div>
          <div class="flex items-center justify-center flex-wrap gap-3 mb-2">
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-primary">{serverFromSlug.name}</h1>
            {serverFromSlug.isNew && (
              <span class="bg-primary/90 text-white px-3 py-1 rounded-full text-sm font-bold shine-effect">
                NEW
              </span>
            )}
          </div>
          <p class="text-white/90 text-lg md:text-xl max-w-2xl mx-auto mb-6" data-i18n={serverFromSlug.descriptionKey}>{t(serverFromSlug.descriptionKey)}</p>
          <div class="flex flex-wrap items-center justify-center gap-3">
            <span class="px-3 py-1 bg-black/30 backdrop-blur-sm rounded-full text-sm border border-primary/30 transition-all hover:border-primary/60 hover:bg-black/50 cursor-default">
              {serverFromSlug.gamemode}
            </span>
            <span class="px-3 py-1 bg-black/30 backdrop-blur-sm rounded-full text-sm border border-primary/30 transition-all hover:border-primary/60 hover:bg-black/50 cursor-default">
              {serverFromSlug.modloader}
            </span>
            {serverFromSlug.versions.map((version) => (
              <span class="px-3 py-1 bg-black/30 backdrop-blur-sm rounded-full text-sm border border-primary/30 transition-all hover:border-primary/60 hover:bg-black/50 cursor-default">
                {version}
              </span>
            ))}
          </div>
        </div>
      </div>

      <!-- Características del servidor -->
      {serverFeatures.length > 0 && (
        <div class="mb-12 reveal-element" data-reveal-delay="100">
          <h2 class="text-2xl font-bold text-primary mb-6" data-i18n="features-title">{t('features-title')}</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {serverFeatures.map((feature, index) => (
              <div class="feature-card bg-black/30 backdrop-blur-sm p-6 rounded-lg text-center border border-primary/10 hover:border-primary/30 hover:shadow-lg" data-reveal-delay={100 + 50 * index}>
                <div class="feature-icon w-16 h-16 bg-black/20 rounded-full flex items-center justify-center mb-4 mx-auto">
                  <i class={`fas ${feature.icon} text-3xl text-primary`}></i>
                </div>
                <h3 class="text-xl font-bold text-primary mb-2" data-i18n={`server-feature-${serverFromSlug.id}-${serverFeatures.indexOf(feature) + 1}-title`}>{t(`server-feature-${serverFromSlug.id}-${serverFeatures.indexOf(feature) + 1}-title`)}</h3>
                <p class="text-white/80" data-i18n={`server-feature-${serverFromSlug.id}-${serverFeatures.indexOf(feature) + 1}-desc`}>{t(`server-feature-${serverFromSlug.id}-${serverFeatures.indexOf(feature) + 1}-desc`)}</p>
              </div>
            ))}
          </div>
        </div>
      )}

      <!-- Tráiler del servidor si existe -->
      {youtubeEmbed && (
        <div class="mb-12 reveal-element" data-reveal-delay="150">
          <h2 class="text-2xl font-bold text-primary mb-6" data-i18n="trailers-title">{t('trailers-title')} {serverFromSlug.name}</h2>
          <div class="relative overflow-hidden pt-[56.25%] rounded-lg border border-primary/20 transition-all hover:border-primary/40 hover:shadow-lg">
            <iframe 
              class="absolute top-0 left-0 w-full h-full border-0"
              src={youtubeEmbed}
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
              allowfullscreen
              loading="lazy"
            ></iframe>
          </div>
        </div>
      )}

      <!-- Imágenes del servidor -->
      <div class="mb-12 reveal-element" data-reveal-delay="200">
        <h2 class="text-2xl font-bold text-primary mb-6" data-i18n="screenshots-title">{t('screenshots-title')}</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {serverFromSlug.images.map((image, index) => (
            <div class="screenshot-container rounded-lg border border-primary/20 overflow-hidden">
              <img 
                src={image} 
                alt={`${serverFromSlug.name} Screenshot ${index + 1}`}
                class="w-full h-64 object-cover transition-transform duration-700"
                width="800"
                height="450"
                loading={index === 0 ? "eager" : "lazy"}
              />
              <div class="screenshot-overlay"></div>
            </div>
          ))}
        </div>
      </div>

      <div class="text-center mb-16 reveal-element" data-reveal-delay="250">
        {serverFromSlug.isActive ? (
          <a 
            href="#join-server" 
            id="join-button"
            class="join-button inline-block px-8 py-4 rounded-full bg-primary/90 text-white font-bold text-lg shadow-glow border border-primary/50 transition-all hover:shadow-lg hover:bg-primary hover:border-primary hover:-translate-y-1 relative overflow-hidden"
          >
            <span class="relative z-10 flex items-center justify-center gap-2">
              <i class="fas fa-gamepad"></i>
              <span data-i18n="join-now">{t('join-now')}</span>
            </span>
          </a>
        ) : (
          <div class="inline-block px-8 py-4 rounded-full bg-gray-700/90 text-white font-bold text-lg border border-gray-600/50 relative overflow-hidden opacity-80">
            <span class="flex items-center justify-center gap-2">
              <i class="fas fa-circle-xmark"></i>
              <span data-i18n="server-closed">{t('server-closed')}</span>
            </span>
          </div>
        )}
      </div>

      <!-- Instrucciones para unirse -->
      <div id="join-server" class="bg-black/30 backdrop-blur-md rounded-xl p-8 border border-primary/20 animate-fade-up animate-delay-400">
        <h2 class="text-2xl font-bold text-primary mb-6" data-i18n="how-to-join-title">{t('how-to-join-title')} {serverFromSlug.name}?</h2>
        
        <!-- Pasos para unirse -->
        <div class="flex flex-wrap justify-around mb-8">
          {serverFromSlug.modloader !== "Vanilla" ? (
            <>
              <div class="step text-center max-w-[250px] mb-8">
                <div class="step-number mx-auto w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary mb-3">
                  <span class="text-2xl font-bold">1</span>
                </div>
                <h3 class="font-bold text-primary text-lg mb-2" data-i18n="step1-title-modpack">{t('step1-title-modpack')}</h3>
                <p class="text-white/80" data-i18n="step1-desc-modpack">{t('step1-desc-modpack')}</p>
              </div>
              
              <div class="step text-center max-w-[250px] mb-8">
                <div class="step-number mx-auto w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary mb-3">
                  <span class="text-2xl font-bold">2</span>
                </div>
                <h3 class="font-bold text-primary text-lg mb-2" data-i18n="step2-title-modpack">{t('step2-title-modpack')}</h3>
                <p class="text-white/80" data-i18n="step2-desc-modpack">{t('step2-desc-modpack')}</p>
              </div>
              
              <div class="step text-center max-w-[250px] mb-8">
                <div class="step-number mx-auto w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary mb-3">
                  <span class="text-2xl font-bold">3</span>
                </div>
                <h3 class="font-bold text-primary text-lg mb-2" data-i18n="step3-title-modpack">{t('step3-title-modpack')}</h3>
                <p class="text-white/80" data-i18n="step3-desc-modpack">{t('step3-desc-modpack')} {serverFromSlug.name}!"</p>
              </div>
            </>
          ) : (
            <>
              <div class="step text-center max-w-[250px] mb-8">
                <div class="step-number mx-auto w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary mb-3">
                  <span class="text-2xl font-bold">1</span>
                </div>
                <h3 class="font-bold text-primary text-lg mb-2" data-i18n="step1-title-vanilla">{t('step1-title-vanilla')}</h3>
                <p class="text-white/80" data-i18n="step1-desc-vanilla">{t('step1-desc-vanilla')} {serverFromSlug.versions[0]}</p>
              </div>
              
              <div class="step text-center max-w-[250px] mb-8">
                <div class="step-number mx-auto w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary mb-3">
                  <span class="text-2xl font-bold">2</span>
                </div>
                <h3 class="font-bold text-primary text-lg mb-2" data-i18n="step2-title-vanilla">{t('step2-title-vanilla')}</h3>
                <p class="text-white/80" data-i18n="step2-desc-vanilla">{t('step2-desc-vanilla')}</p>
              </div>
              
              <div class="step text-center max-w-[250px] mb-8">
                <div class="step-number mx-auto w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary mb-3">
                  <span class="text-2xl font-bold">3</span>
                </div>
                <h3 class="font-bold text-primary text-lg mb-2" data-i18n="step3-title-vanilla">{t('step3-title-vanilla')}</h3>
                <p class="text-white/80" data-i18n="step3-desc-vanilla">{t('step3-desc-vanilla')}</p>
              </div>
            </>
          )}
        </div>
        
        <!-- Instrucciones según el tipo de servidor -->
        {serverFromSlug.modloader === "Vanilla" ? (
          <div class="space-y-6">
            <div class="flex flex-col md:flex-row md:items-center gap-4 p-4 bg-black/40 backdrop-blur-sm rounded-lg">
              <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary">
                <i class="fas fa-gamepad text-2xl"></i>
              </div>
              <div>
                <h3 class="text-lg font-bold text-primary mb-1" data-i18n="minecraft-version-title">{t('minecraft-version-title')}</h3>
                <p data-i18n="minecraft-version-desc">{t('minecraft-version-desc')} {serverFromSlug.versions[0]}</p>
              </div>
            </div>
            
            <div class="flex flex-col md:flex-row md:items-center gap-4 p-4 bg-black/40 backdrop-blur-sm rounded-lg">
              <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary">
                <i class="fas fa-server text-2xl"></i>
              </div>
              <div>
                <h3 class="text-lg font-bold text-primary mb-1" data-i18n="server-address-title">{t('server-address-title')}</h3>
                <p data-i18n="server-address-desc">{t('server-address-desc')}</p>
                <div class="flex items-center gap-2 mt-2">
                  <code class="px-3 py-1 bg-primary/20 rounded border border-primary/30 font-mono text-primary/90">{serverFromSlug.id}.luminakraft.com</code>
                  <button 
                    class="copy-btn w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-primary hover:bg-primary/40 transition-all"
                    data-copy-text={`${serverFromSlug.id}.luminakraft.com`}
                  >
                    <i class="fas fa-copy"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        ) : (
          <div class="space-y-6">
            <div class="flex flex-col md:flex-row md:items-center gap-4 p-4 bg-black/40 backdrop-blur-sm rounded-lg">
              <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary">
                <i class="fas fa-download text-2xl"></i>
              </div>
              <div>
                <h3 class="text-lg font-bold text-primary mb-1" data-i18n="modpack-install-title">{t('modpack-install-title')}</h3>
                <p class="mb-3" data-i18n="modpack-install-desc">{t('modpack-install-desc')}</p>
                {serverFromSlug.isActive ? (
                  <a 
                    href={`/installers/${serverFromSlug.id}-installer.exe`} 
                    class="inline-block px-6 py-2 rounded-lg bg-primary/90 text-white font-bold shadow-glow border border-primary/50 transition-all hover:shadow-lg hover:bg-primary hover:border-primary hover:-translate-y-1"
                    download
                  >
                    <i class="fas fa-download mr-2"></i>
                    <span data-i18n="download-installer">{t('download-installer')}</span>
                  </a>
                ) : (
                  <button 
                    class="inline-block px-6 py-2 rounded-lg bg-gray-700/90 text-white/70 font-bold border border-gray-600/50 cursor-not-allowed opacity-80"
                    disabled
                  >
                    <i class="fas fa-ban mr-2"></i>
                    <span data-i18n="server-closed">{t('server-closed')}</span>
                  </button>
                )}
              </div>
            </div>
            
            <div class="flex flex-col md:flex-row md:items-center gap-4 p-4 bg-black/40 backdrop-blur-sm rounded-lg">
              <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-primary/20 text-primary">
                <i class="fas fa-gamepad text-2xl"></i>
              </div>
              <div>
                <h3 class="text-lg font-bold text-primary mb-1" data-i18n="auto-connect-title">{t('auto-connect-title')}</h3>
                <p data-i18n="auto-connect-desc">{t('auto-connect-desc')} {serverFromSlug.name}!"</p>
              </div>
            </div>
          </div>
        )}
        
        <!-- Discord Join Button -->
        <div class="mt-8 text-center">
          <a 
            href="https://discord.luminakraft.com" 
            target="_blank" 
            class="inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-[#5865F2]/90 text-white font-bold shadow border border-[#5865F2]/50 transition-all hover:shadow-lg hover:bg-[#5865F2] hover:border-[#5865F2] hover:-translate-y-1"
          >
            <i class="fab fa-discord text-xl"></i>
            <span data-i18n="join-discord">{t('join-discord')}</span>
          </a>
        </div>
      </div>
      
      <!-- Leaderboard para servidor -->
      {serverFromSlug.leaderboardPath && (
        <div class="mt-12 mb-12 reveal-element" data-reveal-delay="300">
          <h2 class="text-2xl font-bold text-primary mb-6" data-i18n="leaderboard-title">{t('leaderboard-title')}</h2>
          <p class="text-white/80 mb-8" data-i18n="leaderboard-description">{t('leaderboard-description')}</p>
          
          <div class="bg-black/30 backdrop-blur-md rounded-xl p-6 border border-primary/20">
            <!-- Controles de leaderboard -->
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
              <div class="flex items-center gap-2">
                <label class="text-white/80 players-per-page-label" data-i18n="leaderboard-player-per-page">{t('leaderboard-player-per-page')}</label>
                <select id="playersPerPage" class="bg-secondary/80 text-white border border-primary/50 rounded px-2 py-1">
                  <option value="12">12</option>
                  <option value="24">24</option>
                  <option value="48">48</option>
                </select>
              </div>
              
              <div id="pageIndicator" class="text-white/80" data-i18n-page="page" data-i18n-page-of="page-of"></div>
              
              <div class="flex gap-2">
                <button id="prevPage" class="px-3 py-1 bg-primary/20 rounded text-white/80 hover:bg-primary/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                  <i class="fas fa-chevron-left mr-1"></i> <span data-i18n="previous-page">{t('previous-page')}</span>
                </button>
                <button id="nextPage" class="px-3 py-1 bg-primary/20 rounded text-white/80 hover:bg-primary/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                  <span data-i18n="next-page">{t('next-page')}</span> <i class="fas fa-chevron-right ml-1"></i>
                </button>
              </div>
            </div>
            
            <!-- Grid de jugadores -->
            <div id="leaderboard" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
              <div class="col-span-full flex justify-center p-8">
                <div class="loader w-12 h-12 border-4 border-primary/30 border-t-primary rounded-full animate-spin"></div>
              </div>
            </div>
            
            <!-- Controles de paginación inferiores -->
            <div class="flex flex-col sm:flex-row justify-between items-center mt-6 gap-4">
              <div id="pageIndicatorBottom" class="text-white/80" data-i18n-page="page" data-i18n-page-of="page-of"></div>
              
              <div class="flex gap-2">
                <button id="prevPageBottom" class="px-3 py-1 bg-primary/20 rounded text-white/80 hover:bg-primary/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                  <i class="fas fa-chevron-left mr-1"></i> <span data-i18n="previous-page">{t('previous-page')}</span>
                </button>
                <button id="nextPageBottom" class="px-3 py-1 bg-primary/20 rounded text-white/80 hover:bg-primary/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                  <span data-i18n="next-page">{t('next-page')}</span> <i class="fas fa-chevron-right ml-1"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  </div>
</BaseLayout>

<script define:vars={{ 
  serverId: serverFromSlug.id, 
  leaderboardPath: serverFromSlug.leaderboardPath, 
  isActive: serverFromSlug.isActive,
  translations: {
    leaderboardError: t('leaderboard-error'),
    leaderboardNoData: t('leaderboard-no-data'),
    playerPerPage: t('leaderboard-player-per-page'),
    page: t('page'),
    pageOf: t('page-of'),
    previous: t('previous-page'),
    next: t('next-page'),
    hours: t('leaderboard-hours'),
    kills: t('leaderboard-kills'),
    deaths: t('leaderboard-deaths'),
    mobKills: t('leaderboard-mob-kills'),
    damageReceived: t('leaderboard-damage-received'),
    damageDealt: t('leaderboard-damage-dealt'),
    walked: t('leaderboard-walked'),
    swam: t('leaderboard-swam'),
    boat: t('leaderboard-boat')
  },
  locale,
  i18nData: JSON.stringify({ 
    locale, 
    page: t('page'),
    pageOf: t('page-of')
  })
}}>
  // Controlador para el efecto de revelar elementos al hacer scroll
  document.addEventListener('DOMContentLoaded', function() {
    // Revelar elementos al hacer scroll
    const revealElements = document.querySelectorAll('.reveal-element');
    
    const revealOnScroll = () => {
      const windowHeight = window.innerHeight;
      const scrollY = window.scrollY;
      
      revealElements.forEach(el => {
        const elementTop = el.getBoundingClientRect().top + scrollY;
        const elementVisible = 150;
        
        if (scrollY > elementTop - windowHeight + elementVisible) {
          // Reduce the delay time by using a smaller value
          const delayStr = el.getAttribute('data-reveal-delay') || '0';
          const originalDelay = parseInt(delayStr);
          
          // Apply the animation with reduced delay
          setTimeout(() => {
            el.classList.add('revealed');
          }, originalDelay);
        }
      });
    };
    
    // Ejecutar al cargar la página para los elementos visibles inicialmente
    revealOnScroll();
    
    // Añadir listener para el scroll
    window.addEventListener('scroll', revealOnScroll);
    
    // Copiar al portapapeles
    const copyButtons = document.querySelectorAll('.copy-btn');
    
    copyButtons.forEach(button => {
      button.addEventListener('click', function() {
        const text = button.dataset.copyText || '';
        navigator.clipboard.writeText(text).then(() => {
          // Cambiar ícono temporalmente
          const icon = button.querySelector('i');
          if (icon) {
            icon.className = 'fas fa-check';
            setTimeout(() => {
              icon.className = 'fas fa-copy';
            }, 2000);
          }
        });
      });
    });
    
    // Cargar leaderboard si existe
    if (leaderboardPath) {
      loadLeaderboard();
    }
  });
  
  // Variables para paginación
  let leaderboardData = [];
  let currentPage = 1;
  let playersPerPage = 12;
  let totalPages = 1;
  
  // Función para cargar el leaderboard
  function loadLeaderboard() {
    // Construir la ruta correcta al archivo JSON del leaderboard
    const correctPath = `/data/servers/${serverId}/leaderboard.json`;
    console.log("Cargando leaderboard desde:", correctPath);
    
    fetch(correctPath)
      .then(response => {
        if (!response.ok) {
          throw new Error(`Error al cargar el leaderboard: ${response.status} ${response.statusText}`);
        }
        return response.json();
      })
      .then(data => {
        console.log("Datos del leaderboard cargados:", data);
        leaderboardData = data.Sheet1 || [];
        
        if (!leaderboardData || leaderboardData.length === 0) {
          const leaderboardElement = document.getElementById('leaderboard');
          if (leaderboardElement) {
            leaderboardElement.innerHTML = `<div class="col-span-full text-center p-4 text-gray-400"><i class="fas fa-info-circle mr-2"></i>${translations.leaderboardNoData}</div>`;
          }
          return;
        }
        
        // Inicializar con el valor seleccionado
        const playersPerPageSelect = document.getElementById('playersPerPage');
        if (playersPerPageSelect) {
          playersPerPage = parseInt(playersPerPageSelect.value);
        }
        
        totalPages = Math.ceil(leaderboardData.length / playersPerPage);
        
        // Inicializar paginación
        updatePageIndicators();
        updatePaginationButtons();
        renderLeaderboardPage();
        
        // Configurar eventos para la paginación
        document.getElementById('prevPage').addEventListener('click', goToPreviousPage);
        document.getElementById('nextPage').addEventListener('click', goToNextPage);
        document.getElementById('prevPageBottom').addEventListener('click', goToPreviousPage);
        document.getElementById('nextPageBottom').addEventListener('click', goToNextPage);
        
        // Cambiar jugadores por página
        if (playersPerPageSelect) {
          playersPerPageSelect.addEventListener('change', function() {
            playersPerPage = parseInt(this.value);
            currentPage = 1;
            totalPages = Math.ceil(leaderboardData.length / playersPerPage);
            updatePageIndicators();
            updatePaginationButtons();
            renderLeaderboardPage();
          });
        }
      })
      .catch(error => {
        console.error("Error cargando leaderboard:", error);
        const leaderboardElement = document.getElementById('leaderboard');
        if (leaderboardElement) {
          leaderboardElement.innerHTML = `<div class="col-span-full text-center p-4 text-red-400"><i class="fas fa-exclamation-circle mr-2"></i>${translations.leaderboardError}</div>`;
        }
      });
  }
  
  // Funciones para la paginación
  function goToNextPage() {
    if (currentPage < totalPages) {
      currentPage++;
      updatePageIndicators();
      updatePaginationButtons();
      renderLeaderboardPage();
    }
  }
  
  function goToPreviousPage() {
    if (currentPage > 1) {
      currentPage--;
      updatePageIndicators();
      updatePaginationButtons();
      renderLeaderboardPage();
    }
  }
  
  // Función para actualizar los indicadores de página
  function updatePageIndicators() {
    const pageIndicator = document.getElementById('pageIndicator');
    const pageIndicatorBottom = document.getElementById('pageIndicatorBottom');
    
    // Get translations from the data attributes
    const page = document.documentElement.lang === 'en' ? 'Page' : 'Página';
    const pageOf = document.documentElement.lang === 'en' ? 'of' : 'de';
    
    // Format properly with spacing based on current language
    const pageText = `${page} ${currentPage} ${pageOf} ${totalPages}`;
    
    if (pageIndicator) pageIndicator.textContent = pageText;
    if (pageIndicatorBottom) pageIndicatorBottom.textContent = pageText;
  }
  
  // Make updatePageIndicators globally accessible
  window.updatePageIndicators = updatePageIndicators;
  
  // Add an event listener to update page indicators when language changes
  document.addEventListener('languageChanged', function(e) {
    updatePageIndicators();
    
    // Update tooltips when language changes
    if (typeof window.updateTooltipsForLocale === 'function') {
      window.updateTooltipsForLocale(e.detail.locale);
    }
  });
  
  function updatePaginationButtons() {
    const prevButton = document.getElementById('prevPage');
    const nextButton = document.getElementById('nextPage');
    const prevButtonBottom = document.getElementById('prevPageBottom');
    const nextButtonBottom = document.getElementById('nextPageBottom');
    
    if (prevButton) prevButton.disabled = currentPage === 1;
    if (nextButton) nextButton.disabled = currentPage === totalPages;
    if (prevButtonBottom) prevButtonBottom.disabled = currentPage === 1;
    if (nextButtonBottom) nextButtonBottom.disabled = currentPage === totalPages;
  }
  
  function renderLeaderboardPage() {
    try {
      const leaderboardElement = document.getElementById('leaderboard');
      if (!leaderboardElement) {
        console.error("Elemento leaderboard no encontrado");
        return;
      }
      
      if (!leaderboardData || leaderboardData.length === 0) {
        leaderboardElement.innerHTML = `<div class="col-span-full text-center p-4 text-gray-400"><i class="fas fa-info-circle mr-2"></i>${translations.leaderboardNoData}</div>`;
        return;
      }
      
      const start = (currentPage - 1) * playersPerPage;
      const end = Math.min(start + playersPerPage, leaderboardData.length);
      const playersToShow = leaderboardData.slice(start, end);
      
      console.log(`Renderizando página ${currentPage}, mostrando jugadores ${start}-${end} de ${leaderboardData.length}`);
      
      let html = '';
      
      playersToShow.forEach((player, index) => {
        try {
          const rank = start + index + 1;
          const nombre = player.Usuario || "Desconocido";
          const horas = player.Horas || "0";
          const killsJugadores = player["Kills (jugadores)"] || "0";
          const muertes = player.Muertes || "0";
          const killsMobs = player["Kill (mobs)"] || "0";
          const danoRecibido = player["Daño Recibido"] || "0";
          const danoCausado = player["Daño Causado"] || "0";
          const caminado = player["Caminado (km)"] || "0";
          const nadado = player["Nadado (km)"] || "0";
          const barco = player["Barco (km)"] || "0";
          
          html += `
            <div class="player-card bg-black/40 backdrop-blur-sm p-4 rounded-lg text-center border border-primary/10 hover:border-primary/30 transition-all hover:transform hover:scale-105 cursor-pointer" data-expanded="false">
              <div class="rank text-xl font-bold text-primary">#${rank}</div>
              <div class="name mt-2">
                <img src="https://mc-heads.net/avatar/${nombre}/64" alt="${nombre}" class="w-16 h-16 rounded-lg mx-auto shadow-md" loading="lazy">
                <p class="mt-2 font-medium">${nombre}</p>
              </div>
              <div class="stats flex justify-center gap-4 mt-2">
                <div class="hours text-primary" title="${translations.hours}" data-i18n-tooltip="leaderboard-hours">
                  <i class="fas fa-clock"></i> ${horas}h
                </div>
                <div class="kills text-primary" title="${translations.kills}" data-i18n-tooltip="leaderboard-kills">
                  <i class="fas fa-skull"></i> ${killsJugadores}
                </div>
              </div>
              <div class="player-details max-h-0 overflow-hidden opacity-0 transition-all duration-200 mt-0">
                <div class="border-t border-primary/20 my-3"></div>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div title="${translations.deaths}" data-i18n-tooltip="leaderboard-deaths"><i class="fas fa-skull-crossbones text-red-400"></i> ${muertes}</div>
                  <div title="${translations.mobKills}" data-i18n-tooltip="leaderboard-mob-kills"><i class="fas fa-dragon text-green-400"></i> ${killsMobs}</div>
                  <div title="${translations.damageReceived}" data-i18n-tooltip="leaderboard-damage-received"><i class="fas fa-heart-broken text-red-400"></i> ${danoRecibido}</div>
                  <div title="${translations.damageDealt}" data-i18n-tooltip="leaderboard-damage-dealt"><i class="fas fa-fist-raised text-green-400"></i> ${danoCausado}</div>
                  <div title="${translations.walked}" data-i18n-tooltip="leaderboard-walked"><i class="fas fa-walking text-blue-400"></i> ${caminado}km</div>
                  <div title="${translations.swam}" data-i18n-tooltip="leaderboard-swam"><i class="fas fa-person-swimming text-blue-400"></i> ${nadado}km</div>
                  <div colspan="2" class="text-center" title="${translations.boat}" data-i18n-tooltip="leaderboard-boat"><i class="fas fa-ship text-blue-400"></i> ${barco}km</div>
                </div>
              </div>
            </div>
          `;
        } catch (playerError) {
          console.error("Error procesando jugador:", playerError, player);
        }
      });
      
      leaderboardElement.innerHTML = html || `<div class="col-span-full text-center p-4 text-gray-400"><i class="fas fa-info-circle mr-2"></i>${translations.leaderboardNoData}</div>`;
      
      // Añadir eventos para expandir/colapsar detalles
      document.querySelectorAll('.player-card').forEach(card => {
        card.addEventListener('click', () => {
          const details = card.querySelector('.player-details');
          const isExpanded = card.getAttribute('data-expanded') === 'true';
          
          if (isExpanded) {
            // Colapsar
            details.classList.remove('max-h-60', 'opacity-100', 'mt-3');
            details.classList.add('max-h-0', 'opacity-0', 'mt-0');
            card.setAttribute('data-expanded', 'false');
          } else {
            // Expandir
            details.classList.remove('max-h-0', 'opacity-0', 'mt-0');
            details.classList.add('max-h-60', 'opacity-100', 'mt-3');
            card.setAttribute('data-expanded', 'true');
          }
        });
      });
      
      // Update tooltips after rendering player cards
      if (typeof window.updateTooltipsForLocale === 'function') {
        window.updateTooltipsForLocale(document.documentElement.lang);
      }
    } catch (error) {
      console.error("Error renderizando leaderboard:", error);
      const leaderboardElement = document.getElementById('leaderboard');
      if (leaderboardElement) {
        leaderboardElement.innerHTML = `<div class="col-span-full text-center p-4 text-red-400"><i class="fas fa-exclamation-circle mr-2"></i>${translations.leaderboardError}</div>`;
      }
    }
  }
</script>

<style>
  /* Estilos para los efectos de revelación */
  .reveal-element {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }
  
  .reveal-element.revealed {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Efecto de brillo para badges */
  .shine-effect {
    position: relative;
    overflow: hidden;
  }
  
  .shine-effect::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
    transform: rotate(25deg);
    animation: shine 2s infinite;
    pointer-events: none;
  }
  
  @keyframes shine {
    0% { transform: translateX(-100%) rotate(25deg); }
    100% { transform: translateX(100%) rotate(25deg); }
  }
  
  /* Utilidades adicionales */
  .hover\:scale-135:hover {
    transform: scale(1.35);
  }
</style>

<script>
  import { updateTextsForLocale, getUserLocale, updateTooltipsForLocale } from '../../utils/i18n';
  
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize translations
    const userLocale = getUserLocale();
    if (userLocale) {
      updateTextsForLocale(userLocale);
      
      // Also update the HTML lang attribute
      document.documentElement.lang = userLocale;
      
      // Update tooltips for initial language
      setTimeout(() => {
        updateTooltipsForLocale(userLocale);
      }, 100);
      
      // Update leaderboard pagination
      const event = new CustomEvent('languageChanged', { 
        detail: { locale: userLocale } 
      });
      document.dispatchEvent(event);
    }
  });
</script>