---
// Componente de tarjeta con efecto 3D interactivo
interface Props {
  title: string;
  description: string;
  imageUrl: string;
  linkHref: string;
  linkText: string;
  status?: 'open' | 'closed' | 'coming-soon';
}

const { title, description, imageUrl, linkHref, linkText, status = 'open' } = Astro.props;
---

<div class="interactive-card">
  <div class="card-inner">
    <div class="card-content">
      <div class="card-image-container">
        <img src={imageUrl} alt={title} loading="lazy" class="card-image" />
        {status === 'closed' && <div class="status-badge closed">{Astro.slots.has('status-closed') ? <slot name="status-closed" /> : "Cerrado"}</div>}
        {status === 'coming-soon' && <div class="status-badge coming-soon">{Astro.slots.has('status-coming') ? <slot name="status-coming" /> : "Próximamente"}</div>}
      </div>
      <div class="card-body">
        <h3 class="card-title">{title}</h3>
        <p class="card-description">{description}</p>
        <div class="card-action">
          {status === 'open' ? (
            <a href={linkHref} class="card-button glow-button">
              <span class="button-text">{linkText}</span>
              <div class="button-shine"></div>
            </a>
          ) : status === 'coming-soon' ? (
            <div class="card-button coming-soon-button">
              <span class="button-text">{Astro.slots.has('button-coming') ? <slot name="button-coming" /> : "Próximamente"}</span>
            </div>
          ) : (
            <div class="card-button closed-button">
              <span class="button-text">{Astro.slots.has('button-closed') ? <slot name="button-closed" /> : "Cerrado"}</span>
            </div>
          )}
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .interactive-card {
    position: relative;
    perspective: 1000px;
    width: 100%;
    margin-bottom: 2rem;
    border-radius: 16px;
    transition: transform 0.4s ease;
  }
  
  .interactive-card:hover {
    transform: scale(1.05);
    z-index: 1;
  }
  
  .card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    background-color: rgba(1, 26, 56, 0.7);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
    transform-style: preserve-3d;
    will-change: transform;
  }
  
  .interactive-card:hover .card-inner {
    box-shadow: 0 10px 25px rgba(0, 162, 255, 0.4);
    transform: translateY(-10px);
  }
  
  .card-content {
    position: relative;
    width: 100%;
    transition: transform 0.3s ease;
  }
  
  .card-image-container {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
    border-radius: 16px 16px 0 0;
  }
  
  .card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  
  .interactive-card:hover .card-image {
    transform: scale(1.1);
  }
  
  .status-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.85rem;
    text-transform: uppercase;
    z-index: 2;
  }
  
  .status-badge.closed {
    background-color: rgba(220, 38, 38, 0.9);
    color: white;
  }
  
  .status-badge.coming-soon {
    background-color: rgba(245, 158, 11, 0.9);
    color: white;
  }
  
  .card-body {
    padding: 1.5rem;
  }
  
  .card-title {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 0.75rem;
    color: white;
  }
  
  .card-description {
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 1.5rem;
    line-height: 1.5;
  }
  
  .card-action {
    margin-top: auto;
  }
  
  .card-button {
    display: inline-block;
    padding: 10px 20px;
    border-radius: 30px;
    font-weight: bold;
    text-align: center;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }
  
  .glow-button {
    background: linear-gradient(to right, rgba(0, 162, 255, 0.8), rgba(0, 92, 230, 0.8));
    color: white;
    border: 1px solid rgba(0, 162, 255, 0.3);
  }
  
  .glow-button:hover {
    background: linear-gradient(to right, rgba(0, 162, 255, 1), rgba(0, 92, 230, 1));
    box-shadow: 0 0 15px rgba(0, 162, 255, 0.5);
    transform: translateY(-3px);
  }
  
  .button-shine {
    position: absolute;
    top: -180%;
    left: -230%;
    width: 200%;
    height: 200%;
    opacity: 0;
    transform: rotate(30deg);
    background: rgba(255, 255, 255, 0.13);
    background: linear-gradient(
      to right, 
      rgba(255, 255, 255, 0.13) 0%,
      rgba(255, 255, 255, 0.13) 77%,
      rgba(255, 255, 255, 0.5) 92%,
      rgba(255, 255, 255, 0.0) 100%
    );
  }
  
  .glow-button:hover .button-shine {
    opacity: 1;
    top: -30%;
    left: -30%;
    transition: all 0.5s ease;
  }
  
  .coming-soon-button {
    background-color: rgba(245, 158, 11, 0.3);
    color: white;
    border: 1px solid rgba(245, 158, 11, 0.3);
  }
  
  .closed-button {
    background-color: rgba(220, 38, 38, 0.3);
    color: white;
    border: 1px solid rgba(220, 38, 38, 0.3);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Solo aplicar efectos 3D si no es un dispositivo móvil (para mejor rendimiento)
    if (window.innerWidth > 768) {
      const cards = document.querySelectorAll('.interactive-card');
      
      cards.forEach(card => {
        const cardInner = card.querySelector('.card-inner') as HTMLElement;
        
        card.addEventListener('mousemove', (e: MouseEvent) => {
          // Solo si tenemos el elemento interno
          if (!cardInner) return;
          
          const cardRect = card.getBoundingClientRect();
          const centerX = cardRect.left + cardRect.width / 2;
          const centerY = cardRect.top + cardRect.height / 2;
          const mouseX = e.clientX;
          const mouseY = e.clientY;
          
          // Calcular la posición relativa del ratón sobre la tarjeta (de -1 a 1)
          const relativeX = (mouseX - centerX) / (cardRect.width / 2);
          const relativeY = (mouseY - centerY) / (cardRect.height / 2);
          
          // Limitar la rotación a 6 grados para un efecto sutil
          const rotationIntensity = 6;
          cardInner.style.transform = `rotateY(${relativeX * rotationIntensity}deg) rotateX(${-relativeY * rotationIntensity}deg) translateY(-10px)`;
        });
        
        // Restaurar posición al salir del elemento
        card.addEventListener('mouseleave', () => {
          if (cardInner) {
            cardInner.style.transform = 'rotateY(0) rotateX(0) translateY(0)';
          }
        });
      });
    }
  });
</script>
