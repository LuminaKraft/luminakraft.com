---
import { getTranslation } from '../utils/i18n';

interface Collaborator {
  name: string;
  logo: string;
}

interface Props {
  id: string;
  name: string;
  slug: string;
  isNew: boolean;
  isActive: boolean;
  isComingSoon: boolean;
  image: string;
  logo?: string;
  collaborators: Collaborator[];
  descriptionKey: string;
  locale?: 'es' | 'en';
}

const { 
  id, 
  name, 
  slug, 
  isNew, 
  isActive,
  isComingSoon,
  image, 
  logo, 
  collaborators, 
  descriptionKey,
  locale = 'es'
} = Astro.props;

// Usar directamente la clave de descripción proporcionada
const serverDescKey = descriptionKey;
---

<div class={`server-card relative overflow-hidden rounded-xl bg-secondary/60 backdrop-blur p-5 border border-primary/30 transition-all hover:border-primary/70 hover:shadow-glow group animate-fade-up h-full flex flex-col ${(isNew || isComingSoon) ? 'border-primary/70 shadow-glow' : ''}`}>
  <!-- Etiquetas de estado -->
  <div class="absolute top-4 right-4 z-10">
    {isNew && (
      <div class="bg-primary/90 text-white px-3 py-1 rounded-full text-sm font-bold animate-pulse">
        <span data-i18n="new">{getTranslation('new', locale)}</span>
      </div>
    )}
    {isComingSoon && (
      <div class="bg-primary/90 text-white px-3 py-1 rounded-full text-sm font-bold animate-pulse">
        <span data-i18n="coming-soon">{getTranslation('coming-soon', locale)}</span>
      </div>
    )}
    {!isActive && !isComingSoon && (
      <div class="bg-gray-600/90 text-white px-3 py-1 rounded-full text-sm font-bold">
        <span data-i18n="server-closed">{getTranslation('server-closed', locale)}</span>
      </div>
    )}
  </div>
  
  <!-- Imagen de fondo del servidor -->
  <div class="server-image-container w-full h-48 overflow-hidden rounded-lg relative">
    <img 
      src={image} 
      alt={`Servidor ${name}`} 
      class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
      width="800" 
      height="450" 
      loading={isNew ? "eager" : "lazy"}
    />
    
    <!-- Logo del servidor superpuesto -->
    {logo && (
      <div class="absolute inset-0 flex items-center justify-center p-4">
        <div class="blur-overlay absolute inset-0 bg-black/20 backdrop-blur-sm opacity-100 transition-all duration-700 ease-in-out group-hover:opacity-100 group-hover:backdrop-blur-xl group-hover:bg-black/50"></div>
        <div class="logo-container relative z-10 flex items-center justify-center p-3 transition-all duration-700 ease-in-out">
          <img 
            src={logo} 
            alt={`Logo de ${name}`} 
            class="max-w-full max-h-full object-contain transition-transform duration-700 ease-in-out scale-100 group-hover:scale-115"
            loading="lazy"
          />
        </div>
      </div>
    )}
  </div>
  
  <!-- Nombre del servidor -->
  <h3 class="text-2xl font-bold mt-4 text-primary">{name}</h3>
  
  <!-- Descripción del servidor -->
  <p class="text-white/80 my-3 min-h-[60px]" data-i18n={serverDescKey}>{getTranslation(serverDescKey, locale)}</p>
  
  <!-- Colaboradores -->
  <div class="flex items-center space-x-2 mb-4">
    {collaborators.map((collab, i) => (
      <>
        <img 
          src={collab.logo} 
          alt={`${collab.name} Logo`} 
          class="w-8 h-8 rounded-full border border-primary/50 transition-transform hover:scale-110"
          width="32" 
          height="32" 
          loading="lazy"
        />
        {i < collaborators.length - 1 && 
          <span class="text-primary mx-1">×</span>
        }
      </>
    ))}
  </div>
  
  <!-- Botón para unirse o ver servidor -->
  <div class="mt-auto">
    <a 
      href={`/servers/${slug}`}
      class={`block w-full py-3 rounded-lg text-center font-bold transition-all duration-300 relative overflow-hidden ${
        isActive 
          ? 'bg-gradient-to-r from-primary/80 to-primary text-white hover:shadow-glow hover:scale-[1.02] transform duration-300' 
          : isComingSoon
          ? 'bg-primary/80 text-white hover:shadow-glow hover:scale-[1.02] transform duration-300'
          : 'bg-gray-700 text-gray-300 hover:bg-gray-600 hover:scale-[1.02] transform duration-300'
      }`}
    >
      <span class="relative z-10" data-i18n={isActive ? "join-now" : "view-server"}>
        {isActive 
          ? getTranslation('join-now', locale) 
          : getTranslation('view-server', locale)
        }
      </span>
      {(isActive || isComingSoon) && (
        <span class="absolute inset-0 w-full h-full bg-gradient-to-r from-primary to-primary/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
      )}
    </a>
  </div>
</div>

<style>
    .server-card {
        transition: all 0.3s ease;
        min-height: 26rem;
    }
    
    .logo-container {
        position: relative;
        max-width: 80%;
        max-height: 80%;
        transition: all 0.7s cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    
    .server-card:hover .logo-container {
        max-width: 90%;
        max-height: 90%;
        transform: scale(1.2);
        z-index: 20;
    }
    
    .blur-overlay {
        border-radius: 8px;
    }
</style> 