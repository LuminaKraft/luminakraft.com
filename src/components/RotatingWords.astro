---
import { getTranslation } from '../utils/i18n';

interface Props {
  words: string[];
  locale?: 'es' | 'en';
}

const { words = [
  'word-adventure',
  'word-universe',
  'word-journey',
  'word-destiny',
  'word-realm',
  'word-legacy',
  'word-world',
  'word-magic',
  'word-story',
  'word-quest',
  'word-fantasy',
  'word-legend',
  'word-saga',
  'word-tale',
  'word-epic',
  'word-mission',
  'word-chronicle',
  'word-odyssey',
  'word-mythology',
  'word-fable'
], locale = 'es' } = Astro.props;

// Traducir según el idioma
const t = (key: string) => getTranslation(key, locale);
---

<div class="title-container flex flex-col justify-center items-center text-center">
  <div class="text-white text-4xl md:text-5xl lg:text-6xl font-bold mb-2" data-i18n="hero-title-start">
    {t('hero-title-start')}
  </div>
  <div id="rotatingWordsContainer" class="relative h-16 md:h-20 lg:h-24 overflow-hidden w-full flex justify-center items-center">
    {words.map((wordKey, index) => (
      <span 
        class={`absolute flex items-center justify-center text-4xl md:text-5xl lg:text-6xl font-bold text-primary opacity-0 transition-opacity duration-500 ${index === 0 ? 'active opacity-100' : ''}`}
        data-word={t(wordKey)}
        data-index={index}
        data-i18n-key={wordKey}
      >
        {t(wordKey)}
      </span>
    ))}
  </div>
</div>

<style>
  .text-primary {
    color: #4a90e2;
    text-shadow: 0 0 15px rgba(74, 144, 226, 0.8), 0 0 30px rgba(74, 144, 226, 0.4);
    letter-spacing: 1px;
    font-weight: 800;
    transform: scale(1.05);
  }
  
  #rotatingWordsContainer {
    background: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.3) 20%, rgba(0,0,0,0.3) 80%, rgba(0,0,0,0) 100%);
    border-radius: 8px;
    padding: 0.5rem 0;
  }
</style>

<script>
  // Extender el objeto Window para TypeScript
  declare global {
    interface Window {
      [key: string]: any;
    }
  }

  // Identificador único para este componente
  const ROTATING_WORDS_ID = 'rotatingWords_' + Date.now();
  
  // Variable para el intervalo
  let rotationInterval: number | undefined;

  // Función para controlar la rotación de palabras
  function setupRotatingWords() {
    // Verificar si ya se ha inicializado
    if (window[ROTATING_WORDS_ID]) return;
    
    // Marcar como inicializado
    window[ROTATING_WORDS_ID] = true;
    
    const container = document.getElementById('rotatingWordsContainer');
    if (!container) return;
    
    const words = container.querySelectorAll('span');
    if (words.length === 0) return;
    
    // Remover cualquier función de rotación anterior si existe
    if (rotationInterval) {
      clearInterval(rotationInterval);
      rotationInterval = undefined;
    }
    
    let currentIndex = 0;
    
    // Función para mostrar la palabra actual
    function showWord(index) {
      // Ocultar todas las palabras
      words.forEach(word => {
        word.classList.remove('active', 'opacity-100');
        word.classList.add('opacity-0');
      });
      
      // Mostrar la palabra actual
      words[index].classList.remove('opacity-0');
      words[index].classList.add('active', 'opacity-100');
    }
    
    // Mostrar la primera palabra
    showWord(currentIndex);
    
    // Configurar el intervalo de rotación
    rotationInterval = setInterval(() => {
      // Cambiar al siguiente índice
      currentIndex = (currentIndex + 1) % words.length;
      
      // Mostrar la nueva palabra
      showWord(currentIndex);
    }, 2000);
  }

  // Inicializar cuando el DOM esté listo
  document.addEventListener('DOMContentLoaded', function() {
    setupRotatingWords();
  });

  // También inicializar si astro:page-load se dispara (para navegación SPA)
  document.addEventListener('astro:page-load', function() {
    setupRotatingWords();
  });

  // Función para actualizar las palabras cuando cambia el idioma
  function updateRotatingWords(locale) {
    const container = document.getElementById('rotatingWordsContainer');
    if (!container) return;
    
    const wordElements = container.querySelectorAll('span');
    
    wordElements.forEach(wordElement => {
      const key = wordElement.getAttribute('data-i18n-key');
      if (key) {
        // Buscar la traducción directamente en el objeto de traducciones
        const translations = window.translationsCache?.[locale] || {};
        const translation = translations[key];
        
        if (translation) {
          wordElement.textContent = translation;
          wordElement.setAttribute('data-word', translation);
        }
      }
    });
  }

  // Escuchar eventos de cambio de idioma
  document.addEventListener('languageChanged', function(e: Event) {
    const customEvent = e as CustomEvent<{locale: string}>;
    const locale = customEvent.detail?.locale;
    if (locale) {
      updateRotatingWords(locale);
    }
  });
</script>